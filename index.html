<!DOCTYPE html>
<html>
<head>
    <title>Box Rain Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            cursor: crosshair;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #background {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        #game-canvas {
            position: absolute;
            z-index: 2;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <img id="background" src="wall1.jpg" alt="Background">
        <canvas id="game-canvas"></canvas>
    </div>

    <script>
        const Engine = Matter.Engine,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Events = Matter.Events,
            Body = Matter.Body;

        const CONFIG = {
            GAME_WIDTH: 1920,
            GAME_HEIGHT: 1080,
            PLATFORM: {
                WIDTH: 1337,
                HEIGHT: 216,
                Y_POS: 1080 - 216
            },
            BOX: {
                SIZE: 117,
                SPAWN_OFFSET: -50,
                PHYSICS: {
                    density: 0.8,
                    friction: 0.5,
                    restitution: 0.3
                }
            },
            PARTICLES: {
                COUNT: 5,
                SIZE: 5,
                LIFE: 30,
                SPEED: 0.5
            }
        };

        const engine = Engine.create();
        const render = Render.create({
            element: document.getElementById('game-container'),
            engine: engine,
            canvas: document.getElementById('game-canvas'),
            options: {
                width: CONFIG.GAME_WIDTH,
                height: CONFIG.GAME_HEIGHT,
                wireframes: false,
                background: 'transparent'
            }
        });

        // Система частиц
        const particles = [];
        
        function createParticles(position, color) {
            for(let i = 0; i < CONFIG.PARTICLES.COUNT; i++) {
                const particle = Bodies.circle(
                    position.x,
                    position.y,
                    CONFIG.PARTICLES.SIZE,
                    {
                        render: {
                            fillStyle: color,
                            strokeStyle: '#fff',
                            lineWidth: 2
                        },
                        frictionAir: 0.05,
                        life: CONFIG.PARTICLES.LIFE
                    }
                );
                
                Body.setVelocity(particle, {
                    x: (Math.random() - 0.5) * CONFIG.PARTICLES.SPEED * 10,
                    y: (Math.random() - 0.5) * CONFIG.PARTICLES.SPEED * 10
                });
                
                particles.push(particle);
                World.add(engine.world, particle);
            }
        }

        // Обработчик столкновений
        Events.on(engine, 'collisionStart', (event) => {
            event.pairs.forEach((pair) => {
                const bodyA = pair.bodyA;
                const bodyB = pair.bodyB;
                
                // Определение цвета частиц
                let color = '#FFD700';
                if(bodyA.label === 'box' || bodyB.label === 'box') {
                    color = '#FF4500';
                }

                // Создание частиц в точке столкновения
                createParticles(
                    pair.collision.supports[0],
                    color
                );
            });
        });

        // Платформа
        const platform = Bodies.rectangle(
            CONFIG.GAME_WIDTH / 2,
            CONFIG.PLATFORM.Y_POS - CONFIG.PLATFORM.HEIGHT/2,
            CONFIG.PLATFORM.WIDTH,
            CONFIG.PLATFORM.HEIGHT,
            {
                isStatic: true,
                label: 'platform',
                render: {
                    sprite: {
                        texture: 'R1.jpg',
                        xScale: 1,
                        yScale: 1
                    }
                }
            }
        );

        // Границы
        const boundaries = [
            Bodies.rectangle(-50, CONFIG.GAME_HEIGHT/2, 100, CONFIG.GAME_HEIGHT, { 
                isStatic: true, 
                render: { visible: false } 
            }),
            Bodies.rectangle(CONFIG.GAME_WIDTH + 50, CONFIG.GAME_HEIGHT/2, 100, CONFIG.GAME_HEIGHT, { 
                isStatic: true, 
                render: { visible: false } 
            })
        ];

        World.add(engine.world, [platform, ...boundaries]);

        // Обработка кликов
        document.addEventListener('click', (e) => {
            const rect = render.canvas.getBoundingClientRect();
            const scaleX = CONFIG.GAME_WIDTH / rect.width;
            
            const box = Bodies.rectangle(
                (e.clientX - rect.left) * scaleX,
                CONFIG.BOX.SPAWN_OFFSET,
                CONFIG.BOX.SIZE,
                CONFIG.BOX.SIZE,
                {
                    ...CONFIG.BOX.PHYSICS,
                    label: 'box',
                    render: {
                        sprite: {
                            texture: 'boxX.png',
                            xScale: 1,
                            yScale: 1
                        }
                    }
                }
            );
            
            World.add(engine.world, box);
        });

        // Удаление старых частиц
        setInterval(() => {
            particles.forEach((particle, index) => {
                if(particle.life <= 0) {
                    World.remove(engine.world, particle);
                    particles.splice(index, 1);
                } else {
                    particle.life--;
                }
            });
        }, 1000/60);

        Engine.run(engine);
        Render.run(render);

        function resize() {
            const canvas = render.canvas;
            const scale = Math.min(
                window.innerWidth / CONFIG.GAME_WIDTH,
                window.innerHeight / CONFIG.GAME_HEIGHT
            );
            
            canvas.style.transform = `scale(${scale})`;
        }

        window.addEventListener('resize', resize);
        resize();
    </script>
</body>
</html>

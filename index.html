<!DOCTYPE html>
<html>
<head>
    <title>Box Rain Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            cursor: crosshair;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <script>
        // Инициализация модулей Matter.js
        const Engine = Matter.Engine,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Body = Matter.Body,
            Events = Matter.Events;

        // Создание движка
        const engine = Engine.create();
        
        // Размеры игровой области
        const gameWidth = 1920;
        const gameHeight = 1080;

        // Настройка рендерера
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: gameWidth,
                height: gameHeight,
                wireframes: false,
                background: 'transparent'
            }
        });

        // Загрузка изображений
        const assets = {
            box: new Image(),
            character: new Image(),
            background: new Image()
        };

        assets.box.src = 'boxX.png';
        assets.character.src = 'R1.jpg';
        assets.background.src = 'wall1.jpg';

        // Создание поверхности (персонажа)
        const character = Bodies.rectangle(
            gameWidth/2, 
            gameHeight - 108, // 216px высота персонажа / 2
            1337, 
            216, 
            {
                isStatic: true,
                render: {
                    sprite: {
                        texture: assets.character.src,
                        xScale: 1,
                        yScale: 1
                    }
                }
            }
        );

        // Массив для коробок
        let boxes = [];

        // Обработчик клика мыши
        document.addEventListener('click', (e) => {
            const box = Bodies.rectangle(
                e.clientX * (gameWidth / window.innerWidth), 
                -100, 
                177, 
                177, 
                {
                    restitution: 0.3,
                    friction: 0.5,
                    density: 0.8,
                    render: {
                        sprite: {
                            texture: assets.box.src,
                            xScale: 1,
                            yScale: 1
                        }
                    }
                }
            );
            boxes.push(box);
            World.add(engine.world, box);
        });

        // Добавление границ мира
        World.add(engine.world, [
            // Верхняя невидимая граница
            Bodies.rectangle(gameWidth/2, -50, gameWidth, 100, { isStatic: true, render: { visible: false } }),
            // Боковые границы
            Bodies.rectangle(-50, gameHeight/2, 100, gameHeight, { isStatic: true, render: { visible: false } }),
            Bodies.rectangle(gameWidth + 50, gameHeight/2, 100, gameHeight, { isStatic: true, render: { visible: false } })
        ]);

        // Добавление персонажа в мир
        World.add(engine.world, character);

        // Кастомный рендеринг для фона
        render.canvas.style.background = `url(${assets.background.src}) center/cover no-repeat`;

        // Запуск движка
        Engine.run(engine);
        Render.run(render);

        // Адаптация под размер окна
        window.addEventListener('resize', () => {
            render.options.width = window.innerWidth;
            render.options.height = window.innerHeight;
            Render.lookAt(render, {
                min: { x: 0, y: 0 },
                max: { x: gameWidth, y: gameHeight }
            });
        });

        // Первоначальная настройка камеры
        Render.lookAt(render, {
            min: { x: 0, y: 0 },
            max: { x: gameWidth, y: gameHeight }
        });
    </script>
</body>
</html>

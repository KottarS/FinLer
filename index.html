<!DOCTYPE html>
<html>
<head>
    <title>Box Rain Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            cursor: crosshair;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #background {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        #game-canvas {
            position: absolute;
            z-index: 2;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <img id="background" src="wall1.jpg" alt="Background">
        <canvas id="game-canvas"></canvas>
    </div>

    <script>
        const Engine = Matter.Engine,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies;

        // Конфигурация
        const CONFIG = {
            GAME_WIDTH: 1920,
            GAME_HEIGHT: 1080,
            PLATFORM: {
                WIDTH: 1337,
                HEIGHT: 216,
                Y_POS: 1080 - 216 // Нижний край экрана
            },
            BOX: {
                SIZE: 117,
                SPAWN_OFFSET: -50,
                PHYSICS: {
                    density: 0.8,
                    friction: 0.5,
                    restitution: 0.3
                }
            }
        };

        // Инициализация движка
        const engine = Engine.create();
        
        // Настройка рендерера
        const render = Render.create({
            element: document.getElementById('game-container'),
            engine: engine,
            canvas: document.getElementById('game-canvas'),
            options: {
                width: CONFIG.GAME_WIDTH,
                height: CONFIG.GAME_HEIGHT,
                wireframes: false,
                background: 'transparent'
            }
        });

        // Создание платформы (R1.jpg)
        const platform = Bodies.rectangle(
            CONFIG.GAME_WIDTH / 2,
            CONFIG.PLATFORM.Y_POS - CONFIG.PLATFORM.HEIGHT/2,
            CONFIG.PLATFORM.WIDTH,
            CONFIG.PLATFORM.HEIGHT,
            {
                isStatic: true,
                render: {
                    sprite: {
                        texture: 'R1.jpg',
                        xScale: 1,
                        yScale: 1
                    }
                }
            }
        );

        // Границы мира
        const boundaries = [
            Bodies.rectangle(-50, CONFIG.GAME_HEIGHT/2, 100, CONFIG.GAME_HEIGHT, { 
                isStatic: true, 
                render: { visible: false } 
            }),
            Bodies.rectangle(CONFIG.GAME_WIDTH + 50, CONFIG.GAME_HEIGHT/2, 100, CONFIG.GAME_HEIGHT, { 
                isStatic: true, 
                render: { visible: false } 
            })
        ];

        // Добавление объектов в мир
        World.add(engine.world, [platform, ...boundaries]);

        // Обработка кликов
        document.addEventListener('click', (e) => {
            const rect = render.canvas.getBoundingClientRect();
            const scaleX = CONFIG.GAME_WIDTH / rect.width;
            const scaleY = CONFIG.GAME_HEIGHT / rect.height;
            
            const mouseX = (e.clientX - rect.left) * scaleX;
            
            const box = Bodies.rectangle(
                mouseX,
                CONFIG.BOX.SPAWN_OFFSET,
                CONFIG.BOX.SIZE,
                CONFIG.BOX.SIZE,
                {
                    ...CONFIG.BOX.PHYSICS,
                    render: {
                        sprite: {
                            texture: 'boxX.png',
                            xScale: 1,
                            yScale: 1
                        }
                    }
                }
            );
            
            World.add(engine.world, box);
        });

        // Запуск движка
        Engine.run(engine);
        Render.run(render);

        // Масштабирование
        function resize() {
            const canvas = render.canvas;
            const scale = Math.min(
                window.innerWidth / CONFIG.GAME_WIDTH,
                window.innerHeight / CONFIG.GAME_HEIGHT
            );
            
            canvas.style.transform = `scale(${scale})`;
        }

        window.addEventListener('resize', resize);
        resize();
    </script>
</body>
</html>
